<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Lidan Co</title>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0d1117;
            --surface: #161b22;
            --surface2: #21262d;
            --surface3: #30363d;
            --border: #30363d;
            --border-light: #21262d;
            --accent: #58a6ff;
            --accent-hover: #79b8ff;
            --accent-dim: rgba(88, 166, 255, 0.12);
            --accent-glow: rgba(88, 166, 255, 0.25);
            --text: #e6edf3;
            --text-muted: #8b949e;
            --text-dim: #484f58;
            --success: #3fb950;
            --warning: #d29922;
            --danger: #f85149;
            --sidebar-w: 280px;
            --header-h: 60px;
            --radius: 8px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Sora', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* â”€â”€â”€ LOGIN â”€â”€â”€ */
        #login-overlay {
            position: fixed; inset: 0;
            background: var(--bg);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }
        #login-overlay.hidden { display: none; }

        .login-card {
            width: 100%;
            max-width: 420px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2.5rem;
            box-shadow: 0 25px 60px rgba(0,0,0,0.5);
        }

        .login-logo {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.6rem;
            font-weight: 600;
            color: var(--accent);
            margin-bottom: 0.3rem;
        }

        .login-subtitle {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-bottom: 2rem;
        }

        .field { margin-bottom: 1.2rem; }

        .field label {
            display: block;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .field input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text);
            font-family: 'Sora', sans-serif;
            font-size: 0.95rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .field input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-dim);
        }

        .login-btn {
            width: 100%;
            padding: 0.8rem;
            background: var(--accent);
            color: #0d1117;
            font-family: 'Sora', sans-serif;
            font-size: 0.95rem;
            font-weight: 700;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            transition: background 0.2s, transform 0.15s, box-shadow 0.2s;
            margin-top: 0.5rem;
        }

        .login-btn:hover {
            background: var(--accent-hover);
            box-shadow: 0 0 20px var(--accent-glow);
            transform: translateY(-1px);
        }

        .error-msg {
            color: var(--danger);
            font-size: 0.85rem;
            margin-top: 1rem;
            display: none;
            padding: 0.6rem 0.8rem;
            background: rgba(248, 81, 73, 0.1);
            border: 1px solid rgba(248, 81, 73, 0.3);
            border-radius: 6px;
        }

        /* â”€â”€â”€ SHELL â”€â”€â”€ */
        #app { display: none; min-height: 100vh; }
        #app.visible { display: flex; }

        /* â”€â”€â”€ SIDEBAR â”€â”€â”€ */
        #sidebar {
            width: var(--sidebar-w);
            min-height: 100vh;
            background: var(--surface);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            position: fixed;
            top: 0; left: 0; bottom: 0;
            z-index: 200;
            transform: translateX(0);
            transition: transform 0.3s cubic-bezier(0.4,0,0.2,1);
            overflow-y: auto;
            overflow-x: hidden;
        }

        #sidebar.collapsed { transform: translateX(-100%); }

        .sidebar-header {
            padding: 1rem 1.2rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            min-height: var(--header-h);
        }

        .brand {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.15rem;
            font-weight: 600;
            color: var(--accent);
        }

        .brand span { color: var(--text-muted); font-weight: 400; }

        .sidebar-close {
            display: none;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            line-height: 1;
        }

        .sidebar-close:hover { color: var(--text); background: var(--surface2); }

        .sidebar-nav { flex: 1; padding: 0.75rem 0; }

        /* Category */
        .nav-category {
            padding: 0.6rem 1.2rem 0.3rem;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-dim);
            margin-top: 0.5rem;
        }

        /* Nav item (has children) */
        .nav-group { }

        .nav-group-header {
            display: flex;
            align-items: center;
            padding: 0.55rem 1.2rem;
            cursor: pointer;
            gap: 0.65rem;
            border-radius: 0;
            transition: background 0.15s;
            user-select: none;
            position: relative;
        }

        .nav-group-header:hover { background: var(--surface2); }

        .nav-group-header .icon { font-size: 1rem; flex-shrink: 0; opacity: 0.85; }

        .nav-group-header .label {
            flex: 1;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .nav-group-header .chevron {
            font-size: 0.65rem;
            color: var(--text-dim);
            transition: transform 0.2s;
            flex-shrink: 0;
        }

        .nav-group.open > .nav-group-header .chevron { transform: rotate(90deg); }
        .nav-group.open > .nav-group-header { background: var(--accent-dim); }
        .nav-group.open > .nav-group-header .label { color: var(--accent); }

        /* Sub items */
        .nav-children {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .nav-group.open > .nav-children { max-height: 600px; }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.45rem 1.2rem 0.45rem 2.6rem;
            gap: 0.6rem;
            text-decoration: none;
            font-size: 0.83rem;
            color: var(--text-muted);
            transition: background 0.15s, color 0.15s;
            border-left: 2px solid transparent;
        }

        .nav-link:hover {
            background: var(--surface2);
            color: var(--text);
        }

        .nav-link .link-icon { font-size: 0.85rem; }

        /* Sub-sub level */
        .nav-subgroup { }

        .nav-subgroup-header {
            display: flex;
            align-items: center;
            padding: 0.45rem 1.2rem 0.45rem 2.6rem;
            gap: 0.6rem;
            cursor: pointer;
            font-size: 0.83rem;
            color: var(--text-muted);
            transition: background 0.15s, color 0.15s;
            user-select: none;
        }

        .nav-subgroup-header:hover { background: var(--surface2); color: var(--text); }
        .nav-subgroup-header .label { flex: 1; }
        .nav-subgroup-header .chevron { font-size: 0.6rem; color: var(--text-dim); transition: transform 0.2s; }
        .nav-subgroup.open > .nav-subgroup-header .chevron { transform: rotate(90deg); }
        .nav-subgroup.open > .nav-subgroup-header { color: var(--text); }

        .nav-subchildren {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.25s ease;
        }

        .nav-subgroup.open > .nav-subchildren { max-height: 300px; }

        .nav-sublink {
            display: flex;
            align-items: center;
            padding: 0.4rem 1.2rem 0.4rem 3.8rem;
            gap: 0.5rem;
            text-decoration: none;
            font-size: 0.8rem;
            color: var(--text-dim);
            transition: background 0.15s, color 0.15s;
        }

        .nav-sublink:hover { background: var(--surface2); color: var(--text); }

        .sidebar-footer {
            padding: 1rem 1.2rem;
            border-top: 1px solid var(--border);
        }

        .logout-btn {
            width: 100%;
            padding: 0.6rem;
            background: rgba(248, 81, 73, 0.1);
            color: var(--danger);
            border: 1px solid rgba(248, 81, 73, 0.25);
            border-radius: var(--radius);
            font-family: 'Sora', sans-serif;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .logout-btn:hover { background: rgba(248, 81, 73, 0.2); }

        /* â”€â”€â”€ MAIN CONTENT â”€â”€â”€ */
        #main {
            flex: 1;
            margin-left: var(--sidebar-w);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            transition: margin-left 0.3s;
        }

        .topbar {
            height: var(--header-h);
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding: 0 1.5rem;
            gap: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 6px;
            border-radius: 6px;
            line-height: 1;
        }

        .menu-toggle:hover { background: var(--surface2); color: var(--text); }

        .topbar-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-muted);
            flex: 1;
        }

        .topbar-badge {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            background: var(--accent-dim);
            color: var(--accent);
            padding: 4px 10px;
            border-radius: 20px;
            border: 1px solid rgba(88,166,255,0.2);
        }

        /* â”€â”€â”€ CONTENT â”€â”€â”€ */
        .content {
            padding: 2rem;
            flex: 1;
        }

        .page-header {
            margin-bottom: 2rem;
        }

        .page-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 0.3rem;
        }

        .page-header p { color: var(--text-muted); font-size: 0.875rem; }

        /* â”€â”€â”€ GRID CARDS â”€â”€â”€ */
        .section-title {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-dim);
            margin: 2rem 0 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-title::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
            gap: 1rem;
        }

        .app-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem 1rem;
            text-decoration: none;
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.6rem;
            text-align: center;
            transition: border-color 0.2s, background 0.2s, transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .app-card:hover {
            border-color: var(--accent);
            background: var(--surface2);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3), 0 0 15px var(--accent-dim);
        }

        .app-card .card-icon { font-size: 1.8rem; }
        .app-card .card-label { font-size: 0.82rem; font-weight: 500; color: var(--text-muted); line-height: 1.3; }
        .app-card:hover .card-label { color: var(--text); }

        .app-card.placeholder {
            border-style: dashed;
            border-color: var(--border-light);
            opacity: 0.5;
        }

        .app-card.placeholder:hover {
            opacity: 0.8;
            border-color: var(--text-dim);
            box-shadow: none;
            transform: none;
        }

        /* â”€â”€â”€ OVERLAY â”€â”€â”€ */
        #overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            z-index: 150;
            backdrop-filter: blur(2px);
        }

        #overlay.visible { display: block; }

        /* â”€â”€â”€ RESPONSIVE â”€â”€â”€ */
        @media (max-width: 768px) {
            #sidebar { transform: translateX(-100%); }
            #sidebar.open { transform: translateX(0); }
            .sidebar-close { display: flex !important; align-items: center; justify-content: center; }
            #main { margin-left: 0; }
            .menu-toggle { display: flex !important; align-items: center; }
            .content { padding: 1.2rem; }
            .cards-grid { grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); }
        }

        @media (max-width: 400px) {
            .cards-grid { grid-template-columns: repeat(2, 1fr); }
        }

        /* Scrollbar */
        #sidebar::-webkit-scrollbar { width: 4px; }
        #sidebar::-webkit-scrollbar-track { background: transparent; }
        #sidebar::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
        /* catatan buttons */
        .cn-nav-btn {
            flex-shrink:0; width:16px; height:16px; border-radius:50%;
            background:rgba(99,102,241,.15); color:#818cf8;
            border:1px solid rgba(99,102,241,.3); font-size:10px;
            font-weight:700; cursor:pointer; font-style:italic;
            display:inline-flex; align-items:center; justify-content:center;
            margin-right:4px; opacity:0; transition:opacity .15s;
        }
        span:hover > .cn-nav-btn { opacity:1; }
        .cn-card-btn {
            position:absolute; top:4px; right:4px;
            width:18px; height:18px; border-radius:50%;
            background:rgba(99,102,241,.15); color:#818cf8;
            border:1px solid rgba(99,102,241,.3); font-size:10px;
            font-weight:700; cursor:pointer; font-style:italic;
            display:inline-flex; align-items:center; justify-content:center;
            opacity:0; transition:opacity .15s; z-index:2;
        }
        .app-card:hover .cn-card-btn { opacity:1; }
        /* catatan popup */
        #cn-overlay {
            display:none; position:fixed; inset:0;
            background:rgba(0,0,0,.5); z-index:9999;
            align-items:center; justify-content:center; padding:20px;
        }
        #cn-overlay.open { display:flex; }
        #cn-box {
            background:#1e2130; border:1px solid #2a2f3f; border-radius:12px;
            padding:24px; max-width:460px; width:100%;
            box-shadow:0 20px 60px rgba(0,0,0,.5);
            font-family:'Sora',sans-serif;
        }
        #cn-header { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:14px; }
        #cn-judul { font-size:15px; font-weight:700; color:#e8eaf0; line-height:1.3; flex:1; }
        #cn-close { background:none; border:none; color:#6b7280; font-size:22px; cursor:pointer; padding:0; }
        #cn-close:hover { color:#e8eaf0; }
        #cn-isi { font-size:13px; color:#9ca3af; line-height:1.75; white-space:pre-wrap; }
        #cn-isi strong { color:#e8eaf0; }
        #cn-footer { margin-top:12px; font-size:11px; color:#4b5563; font-family:monospace; }
    </style>
</head>
<body>

<!-- â”€â”€â”€ LOGIN â”€â”€â”€ -->
<!-- Catatan Popup -->
<div id="cn-overlay" onclick="if(event.target===this)cnTutup()">
    <div id="cn-box">
        <div id="cn-header">
            <div id="cn-judul"></div>
            <button id="cn-close" onclick="cnTutup()">&#x2715;</button>
        </div>
        <div id="cn-isi"></div>
        <div id="cn-footer"></div>
    </div>
</div>

<div id="login-overlay">
    <div class="login-card">
        <div class="login-logo">lidan<span>.co</span></div>
        <p class="login-subtitle">Admin Portal â€” Masuk untuk melanjutkan</p>
        <div class="field">
            <label>Username</label>
            <input type="text" id="username" placeholder="Masukkan username" autocomplete="username">
        </div>
        <div class="field">
            <label>Password</label>
            <input type="password" id="password" placeholder="Masukkan password" autocomplete="current-password" onkeydown="if(event.key==='Enter') handleLogin()">
        </div>
        <button class="login-btn" onclick="handleLogin()">Masuk Dashboard</button>
        <p id="error-msg" class="error-msg"></p>
    </div>
</div>

<!-- â”€â”€â”€ APP SHELL â”€â”€â”€ -->
<div id="app">
    <!-- SIDEBAR -->
    <nav id="sidebar">
        <div class="sidebar-header">
            <div class="brand">lidan<span>.co</span></div>
            <button class="sidebar-close" onclick="closeSidebar()">âœ•</button>
        </div>

        <div class="sidebar-nav" id="sidebar-nav">
            <!-- rendered by JS -->
        </div>

        <div class="sidebar-footer">
            <button class="logout-btn" onclick="logout()">ğŸšª Keluar</button>
        </div>
    </nav>

    <!-- OVERLAY (mobile) -->
    <div id="overlay" onclick="closeSidebar()"></div>

    <!-- MAIN -->
    <div id="main">
        <header class="topbar">
            <button class="menu-toggle" onclick="openSidebar()">â˜°</button>
            <span class="topbar-title" id="topbar-title">Dashboard</span>
            <span class="topbar-badge">Admin</span>
        </header>

        <div class="content" id="content">
            <!-- rendered by JS -->
        </div>
    </div>
</div>

<script>
const API_URL = 'https://lidan-co-id.pages.dev/api/contacts_filter_dinamis6';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAV STRUCTURE
   type: 'group'  â†’ collapsible section with children
   type: 'link'   â†’ direct link
   type: 'subgroup' â†’ nested group inside a group
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const navStructure = [
    {
        category: "Utama",
        items: [
            {
                type: 'group', icon: 'ğŸ“Š', label: 'Overview',
                children: [
                    { type: 'link', icon: 'ğŸ ', label: 'Dashboard', href: '#home', cn: 'dashboard' },
                ]
            }
        ]
    },
    {
        category: "Psikotest",
        items: [
            {
                type: 'group', icon: 'ğŸ§ ', label: 'Platform Psikotest',
                children: [
                    { type: 'link', icon: 'ğŸ”¬', label: 'Psikotest Admin', href: 'https://admin.lidan.co.id/admin/psikotest', external: true, cn: 'psikotest_admin_web' },
                    { type: 'link', icon: 'ğŸŒ', label: 'Psikotest.co.id', href: 'https://psikotest.lidan.co.id/', external: true, cn: 'psikotest_co_id' },
                    { type: 'link', icon: 'ğŸŒ', label: 'Psikotest.my.id', href: 'https://psikotest.my.id/', external: true, cn: 'psikotest_my_id' },
                    {
                        type: 'subgroup', icon: 'ğŸ“¦', label: 'Transfer Data',
                        children: [
                            { type: 'link', icon: 'â†•ï¸', label: 'Transfer SQL', href: 'https://lidanpsikologi.my.id/cloud', external: true, cn: 'transfer_sql' },
                            { type: 'link', icon: 'â†•ï¸', label: 'Transfer Psikotest.my.id', href: 'https://psikotest.my.id/transfer', external: true, cn: 'transfer_psikotestmyid' },
                            { type: 'link', icon: 'â†•ï¸', label: 'Transfer Lidanpsikologi', href: 'https://lidanpsikologi.my.id/transfer', external: true, cn: 'transfer_lidanpsikologi' },
                        ]
                    },
                    {
                        type: 'subgroup', icon: 'ğŸ«', label: 'Voucher',
                        children: [
                            { type: 'link', icon: 'ğŸŸï¸', label: 'Voucher LidanPsikologi', href: 'https://pkl.lidan.co.id/', external: true, cn: 'voucher_lidan' },
                            { type: 'link', icon: 'ğŸŸï¸', label: 'Voucher Psikotest', href: 'https://lidanpsikologi.my.id/test/admin/voucher.php', external: true, cn: 'voucher_psikotest' },
                        ]
                    }
                ]
            },
            {
                type: 'group', icon: 'ğŸ“ˆ', label: 'Hasil & Laporan',
                children: [
                    { type: 'link', icon: 'ğŸ“‹', label: 'Psikogram', href: 'https://psikogram.lidan.co.id', external: true, cn: 'psikogram_web' },
                    { type: 'link', icon: 'ğŸ†”', label: 'Who am I', href: 'https://test.lidan.co.id/', external: true, cn: 'whoami_web' },
                    { type: 'link', icon: 'ğŸ“', label: 'IQ Sertifikat', href: 'https://iq.lidan.co.id/', external: true, cn: 'iq_sertifikat' },
                ]
            }
        ]
    },
    {
        category: "Keuangan & Dokumen",
        items: [
            {
                type: 'group', icon: 'ğŸ’°', label: 'Keuangan',
                children: [
                    { type: 'link', icon: 'ğŸ§¾', label: 'Invoice', href: 'https://invoice.lidan.co.id/', external: true, cn: 'invoice_web' },
                    { type: 'link', icon: 'ğŸ§¾', label: 'Kwitansi', href: 'https://kwitansi.lidan.co.id/', external: true, cn: 'kwitansi_web' },
                    { type: 'link', icon: 'ğŸ’¼', label: 'Penawaran', href: 'https://penawaran.lidan.co.id/', external: true, cn: 'penawaran_web' },
                ]
            },
            {
                type: 'group', icon: 'ğŸ“„', label: 'Dokumen',
                children: [
                    { type: 'link', icon: 'âœ‰ï¸', label: 'Surat', href: 'https://surat.lidan.co.id/', external: true, cn: 'surat_web' },
                    { type: 'link', icon: 'ğŸ”—', label: 'QR Code', href: 'https://qr.lidan.co.id/', external: true, cn: 'qr_web' },
                ]
            }
        ]
    },
    {
        category: "PKL & Pendidikan",
        items: [
            {
                type: 'group', icon: 'ğŸ“', label: 'PKL',
                children: [
                    { type: 'link', icon: 'ğŸ‘¨â€ğŸ’¼', label: 'PKL Admin', href: 'https://pkl.lidan.co.id/admin', external: true, cn: 'pkl_admin' },
                    { type: 'link', icon: 'ğŸ«', label: 'PKL Voucher', href: 'https://psikotest.my.id/test/admin/voucher.php', external: true, cn: 'pkl_voucher' },
                ]
            }
        ]
    },
    {
        category: "Sistem",
        items: [
            {
                type: 'group', icon: 'âš™ï¸', label: 'Data & Storage',
                children: [
                    { type: 'link', icon: 'ğŸ’¾', label: 'LocalStorage Admin', href: 'https://admin.lidan.co.id/admin/local', external: true, cn: 'localstorage_admin' },
                ]
            },
            {
                type: 'group', icon: 'ğŸ“¦', label: 'Template Kosong',
                children: [
                    { type: 'link', icon: 'â•', label: 'Tambah Menu Baru', href: '#placeholder', external: false },
                    { type: 'link', icon: 'â•', label: 'Tambah Menu Baru', href: '#placeholder', external: false },
                    { type: 'link', icon: 'â•', label: 'Tambah Menu Baru', href: '#placeholder', external: false },
                ]
            }
        ]
    }
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE DATA (for content area)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const pageData = {
    home: {
        title: 'Dashboard',
        subtitle: 'Selamat datang di Admin Portal Lidan Co',
        sections: [
            {
                heading: 'Psikotest',
                cards: [
                    { icon: 'ğŸ”¬', label: 'Psikotest Admin', href: 'https://admin.lidan.co.id/admin/psikotest', cn: 'psikotest_admin_web' },
                    { icon: 'ğŸŒ', label: 'Psikotest.co.id', href: 'https://psikotest.lidan.co.id/', cn: 'psikotest_co_id' },
                    { icon: 'ğŸŒ', label: 'Psikotest.my.id', href: 'https://psikotest.my.id/', cn: 'psikotest_my_id' },
                    { icon: 'ğŸ“‹', label: 'Psikogram', href: 'https://psikogram.lidan.co.id', cn: 'psikogram_web' },
                    { icon: 'ğŸ†”', label: 'Who am I', href: 'https://test.lidan.co.id/', cn: 'whoami_web' },
                    { icon: 'ğŸ“', label: 'IQ Sertifikat', href: 'https://iq.lidan.co.id/', cn: 'iq_sertifikat' },
                ]
            },{
                heading: 'Psikotest Final',
                cards: [
                    { icon: 'ğŸ”¬', label: 'Psikotest Admin', href: 'https://admin.lidan.co.id/admin/psikotest', cn: 'psikotest_admin_web' },
                    { icon: 'ğŸŒ', label: 'Psikotest.co.id', href: 'https://psikotest.lidan.co.id/', cn: 'psikotest_co_id' },
                    { icon: 'ğŸŒ', label: 'Psikotest.my.id', href: 'https://psikotest.my.id/', cn: 'psikotest_my_id' },
                    { icon: 'ğŸ“‹', label: 'Psikogram', href: 'https://psikogram.lidan.co.id', cn: 'psikogram_web' },
                    { icon: 'ğŸ†”', label: 'Who am I', href: 'https://test.lidan.co.id/', cn: 'whoami_web' },
                    { icon: 'ğŸ“', label: 'IQ Sertifikat', href: 'https://iq.lidan.co.id/', cn: 'iq_sertifikat' },
                ]
            },
            {
                heading: 'Transfer Data',
                cards: [
                    { icon: 'â˜ï¸', label: 'Transfer SQL', href: 'https://lidanpsikologi.my.id/cloud', cn: 'transfer_sql' },
                    { icon: 'â†•ï¸', label: 'Transfer Psikotest.my.id', href: 'https://psikotest.my.id/transfer', cn: 'transfer_psikotestmyid' },
                    { icon: 'â†•ï¸', label: 'Transfer Lidanpsikologi', href: 'https://lidanpsikologi.my.id/transfer', cn: 'transfer_lidanpsikologi' },
                ]
            },
            {
                heading: 'Keuangan & Dokumen',
                cards: [
                    { icon: 'ğŸ§¾', label: 'Invoice', href: 'https://invoice.lidan.co.id/', cn: 'invoice_web' },
                    { icon: 'ğŸ§¾', label: 'Kwitansi', href: 'https://kwitansi.lidan.co.id/', cn: 'kwitansi_web' },
                    { icon: 'ğŸ’¼', label: 'Penawaran', href: 'https://penawaran.lidan.co.id/', cn: 'penawaran_web' },
                    { icon: 'âœ‰ï¸', label: 'Surat', href: 'https://surat.lidan.co.id/', cn: 'surat_web' },
                    { icon: 'ğŸ”—', label: 'QR Code', href: 'https://qr.lidan.co.id/', cn: 'qr_web' },
                ]
            },
            {
                heading: 'Voucher & PKL',
                cards: [
                    { icon: 'ğŸŸï¸', label: 'Voucher LidanPsikologi', href: 'https://pkl.lidan.co.id/', cn: 'voucher_lidan' },
                    { icon: 'ğŸŸï¸', label: 'Voucher Psikotest', href: 'https://lidanpsikologi.my.id/test/admin/voucher.php', cn: 'voucher_psikotest' },
                    { icon: 'ğŸ«', label: 'PKL Voucher', href: 'https://psikotest.my.id/test/admin/voucher.php', cn: 'pkl_voucher' },
                    { icon: 'ğŸ‘¨â€ğŸ’¼', label: 'PKL Admin', href: 'https://pkl.lidan.co.id/admin', cn: 'pkl_admin' },
                ]
            },
            {
                heading: 'Sistem',
                cards: [
                    { icon: 'ğŸ’¾', label: 'LocalStorage Admin', href: 'https://admin.lidan.co.id/admin/local', cn: 'localstorage_admin' },
                ]
            },
            {
                heading: 'Template (Kosong)',
                cards: [
                    { icon: 'â•', label: 'Slot Kosong', href: '#', placeholder: true },
                    { icon: 'â•', label: 'Slot Kosong', href: '#', placeholder: true },
                    { icon: 'â•', label: 'Slot Kosong', href: '#', placeholder: true },
                    { icon: 'â•', label: 'Slot Kosong', href: '#', placeholder: true },
                ]
            }
        ]
    }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER SIDEBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderSidebar() {
    const nav = document.getElementById('sidebar-nav');
    let html = '';

    navStructure.forEach(cat => {
        html += `<div class="nav-category">${cat.category}</div>`;
        cat.items.forEach(item => {
            if (item.type === 'group') {
                html += renderGroup(item);
            } else if (item.type === 'link') {
                html += renderLink(item);
            }
        });
    });

    nav.innerHTML = html;

    // Attach toggle events
    nav.querySelectorAll('.nav-group-header').forEach(header => {
        header.addEventListener('click', () => {
            const group = header.parentElement;
            group.classList.toggle('open');
        });
    });

    nav.querySelectorAll('.nav-subgroup-header').forEach(header => {
        header.addEventListener('click', () => {
            const group = header.parentElement;
            group.classList.toggle('open');
        });
    });

    // Handle nav links
    nav.querySelectorAll('a[href^="#"]').forEach(a => {
        a.addEventListener('click', e => {
            e.preventDefault();
            const page = a.getAttribute('href').replace('#', '') || 'home';
            renderPage(page || 'home');
            if (window.innerWidth <= 768) closeSidebar();
        });
    });
}

function renderGroup(item) {
    let html = `
        <div class="nav-group">
            <div class="nav-group-header">
                <span class="icon">${item.icon}</span>
                <span class="label">${item.label}</span>
                <span class="chevron">â–¶</span>
            </div>
            <div class="nav-children">`;

    item.children.forEach(child => {
        if (child.type === 'subgroup') {
            html += `
                <div class="nav-subgroup">
                    <div class="nav-subgroup-header">
                        <span>${child.icon}</span>
                        <span class="label">${child.label}</span>
                        <span class="chevron">â–¶</span>
                    </div>
                    <div class="nav-subchildren">`;
            child.children.forEach(sub => {
                html += renderLink(sub, true);
            });
            html += `</div></div>`;
        } else {
            html += renderLink(child);
        }
    });

    html += `</div></div>`;
    return html;
}

function renderLink(item, isSub = false) {
    const cls = isSub ? 'nav-sublink' : 'nav-link';
    const target = item.external ? 'target="_blank" rel="noopener"' : '';
    const btn = item.cn ? `<button class="cn-nav-btn" onclick="event.preventDefault();event.stopPropagation();cnBuka('${item.cn}')" title="Catatan">i</button>` : '';
    return `<span style="display:flex;align-items:center;">
        <a href="${item.href}" class="${cls}" ${target} style="flex:1;min-width:0;">
            <span class="link-icon">${item.icon}</span>
            <span>${item.label}</span>
        </a>${btn}
    </span>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER CONTENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderPage(pageId) {
    const data = pageData[pageId] || pageData.home;
    document.getElementById('topbar-title').textContent = data.title;

    let html = `
        <div class="page-header">
            <h2>${data.title}</h2>
            <p>${data.subtitle}</p>
        </div>`;

    data.sections.forEach(section => {
        html += `<div class="section-title">${section.heading}</div>`;
        html += `<div class="cards-grid">`;
        section.cards.forEach(card => {
            const cls = card.placeholder ? 'app-card placeholder' : 'app-card';
            const target = card.placeholder ? '' : 'target="_blank" rel="noopener"';
            const btn = card.cn ? `<button class="cn-card-btn" onclick="event.preventDefault();event.stopPropagation();cnBuka('${card.cn}')" title="Catatan">i</button>` : '';
            html += `<a href="${card.href}" class="${cls}" ${target} style="position:relative;">${btn}
                <span class="card-icon">${card.icon}</span>
                <span class="card-label">${card.label}</span>
            </a>`;
        });
        html += `</div>`;
    });

    document.getElementById('content').innerHTML = html;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIDEBAR TOGGLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openSidebar() {
    document.getElementById('sidebar').classList.add('open');
    document.getElementById('overlay').classList.add('visible');
    document.body.style.overflow = 'hidden';
}

function closeSidebar() {
    document.getElementById('sidebar').classList.remove('open');
    document.getElementById('overlay').classList.remove('visible');
    document.body.style.overflow = '';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function handleLogin() {
    const user = document.getElementById('username').value;
    const pass = document.getElementById('password').value;
    const errMsg = document.getElementById('error-msg');

    if (!user || !pass) {
        errMsg.style.display = 'block';
        errMsg.innerText = 'Username dan password wajib diisi';
        return;
    }

    const btn = document.querySelector('.login-btn');
    btn.textContent = 'Memproses...';
    btn.disabled = true;

    try {
        const response = await fetch(`${API_URL}?action=login`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-Custom-Auth': 'admin',
                'X-Role': 'admin'
            },
            body: JSON.stringify({ username: user, password: pass })
        });

        const result = await response.json();

        if (result.success) {
            localStorage.setItem('isAdminLoggedIn', 'true');
            showDashboard();
        } else {
            errMsg.style.display = 'block';
            errMsg.innerText = result.message || 'Login Gagal. Periksa kembali kredensial Anda.';
        }
    } catch (error) {
        console.error(error);
        errMsg.style.display = 'block';
        errMsg.innerText = 'Terjadi kesalahan koneksi. Coba lagi.';
    } finally {
        btn.textContent = 'Masuk Dashboard';
        btn.disabled = false;
    }
}

function showDashboard() {
    document.getElementById('login-overlay').classList.add('hidden');
    document.getElementById('app').classList.add('visible');
    renderSidebar();
    renderPage('home');
}

function logout() {
    localStorage.removeItem('isAdminLoggedIn');
    location.reload();
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CATATAN DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const CATATAN = {
  "dashboard": { judul: "Dashboard", isi: "Halaman utama Admin Portal Lidan Co.\nMenunjukkan shortcut ke semua aplikasi per kategori.\n**Kategori:** Psikotest, Transfer Data, Keuangan, Dokumen, Voucher, PKL, Sistem" },
  "psikotest_admin_web": { judul: "Psikotest Admin", isi: "Panel admin pengelolaan psikotest.\n**URL:** admin.lidan.co.id/admin/psikotest\n**Fungsi:** manajemen peserta, token, dan hasil tes" },
  "psikotest_co_id": { judul: "Psikotest.co.id", isi: "Platform psikotest utama.\n**URL:** psikotest.lidan.co.id\n**Fungsi:** peserta mengerjakan tes psikologi secara online" },
  "psikotest_my_id": { judul: "Psikotest.my.id", isi: "Platform psikotest alternatif.\n**URL:** psikotest.my.id\n**Fungsi:** peserta mengerjakan tes psikologi secara online" },
  "transfer_sql": { judul: "Transfer SQL", isi: "Transfer data SQL antar database.\n**URL:** lidanpsikologi.my.id/cloud\n**Fungsi:** sinkronisasi atau migrasi data" },
  "transfer_psikotestmyid": { judul: "Transfer Psikotest.my.id", isi: "Transfer hasil tes dari psikotest.my.id.\n**URL:** psikotest.my.id/transfer\n**Fungsi:** pindahkan data hasil tes ke database tujuan" },
  "transfer_lidanpsikologi": { judul: "Transfer LidanPsikologi", isi: "Transfer hasil tes dari lidanpsikologi.my.id.\n**URL:** lidanpsikologi.my.id/transfer\n**Fungsi:** pindahkan data hasil tes ke database tujuan" },
  "psikogram_web": { judul: "Psikogram", isi: "Laporan psikogram hasil tes peserta.\n**URL:** psikogram.lidan.co.id\n**Fungsi:** tampilkan hasil analisis psikologi lengkap" },
  "whoami_web": { judul: "Who am I", isi: "Tes kepribadian Who am I.\n**URL:** test.lidan.co.id\n**Fungsi:** peserta mengetahui tipe kepribadiannya" },
  "iq_sertifikat": { judul: "IQ Sertifikat", isi: "Cetak sertifikat hasil tes IQ.\n**URL:** iq.lidan.co.id\n**Fungsi:** hasilkan sertifikat resmi hasil tes IQ" },
  "invoice_web": { judul: "Invoice", isi: "Aplikasi pembuatan invoice.\n**URL:** invoice.lidan.co.id\n**Fungsi:** buat, cetak, kelola invoice klien" },
  "kwitansi_web": { judul: "Kwitansi", isi: "Aplikasi kwitansi pembayaran.\n**URL:** kwitansi.lidan.co.id\n**Fungsi:** buat dan cetak kwitansi tanda terima" },
  "penawaran_web": { judul: "Surat Penawaran", isi: "Aplikasi surat penawaran.\n**URL:** penawaran.lidan.co.id\n**Fungsi:** buat dan cetak dokumen penawaran klien" },
  "surat_web": { judul: "Surat", isi: "Aplikasi surat resmi.\n**URL:** surat.lidan.co.id\n**Fungsi:** buat dan cetak berbagai jenis surat resmi" },
  "qr_web": { judul: "QR Code Generator", isi: "Generator QR Code.\n**URL:** qr.lidan.co.id\n**Fungsi:** buat QR code dari URL atau teks apapun" },
  "voucher_lidan": { judul: "Voucher LidanPsikologi", isi: "Voucher akses psikotest LidanPsikologi.\n**URL:** pkl.lidan.co.id\n**Fungsi:** generate dan kelola kode voucher" },
  "voucher_psikotest": { judul: "Voucher Psikotest", isi: "Voucher akses psikotest.\n**URL:** lidanpsikologi.my.id/test/admin/voucher.php\n**Fungsi:** generate dan kelola kode voucher" },
  "pkl_admin": { judul: "PKL Admin", isi: "Panel admin PKL.\n**URL:** pkl.lidan.co.id/admin\n**Fungsi:** kelola peserta PKL, absensi, laporan" },
  "pkl_voucher": { judul: "PKL Voucher", isi: "Voucher psikotest untuk peserta PKL.\n**URL:** psikotest.my.id/test/admin/voucher.php\n**Fungsi:** generate voucher akses untuk peserta PKL" },
  "localstorage_admin": { judul: "LocalStorage Admin", isi: "Manajemen data LocalStorage browser.\n**URL:** admin.lidan.co.id/admin/local\n**Fungsi:** lihat, edit, hapus data localStorage" },
};

function cnBuka(key) {
    const d = CATATAN[key];
    document.getElementById('cn-judul').textContent = d ? (d.judul || key) : 'Catatan tidak ditemukan';
    const isi = d ? (d.isi || '') : 'Key "' + key + '" tidak ada di CATATAN.';
    document.getElementById('cn-isi').innerHTML = isi
        .replace(/&/g,'&amp;').replace(/</g,'&lt;')
        .replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>');
    document.getElementById('cn-footer').textContent = 'key: "' + key + '"';
    document.getElementById('cn-overlay').classList.add('open');
}
function cnTutup() {
    document.getElementById('cn-overlay').classList.remove('open');
}
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') cnTutup();
});

window.onload = () => {
    if (localStorage.getItem('isAdminLoggedIn') === 'true') {
        showDashboard();
    }
};
</script>
</body>
</html>